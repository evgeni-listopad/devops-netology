# Домашнее задание к занятию 11.3 «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

### Решение задачи 1

В качестве решения для обеспечения процесса разработки можно предложить несколько вариантов программных продуктов:

* Jenkins — это широко известный, бесплатный, гибкий CI/CD-инструмент, предназначенный для автоматизации множества задач, связанных с программными проектами. Jenkins написан на Java, он выпущен под лицензией MIT. Он обладает мощным набором возможностей, направленных на автоматизацию задач, связанных со сборкой, тестированием, развёртыванием, интеграцией, выпуском программного обеспечения. Для использования собственных докер-образов можно в дополнение к Jenkins использовать docker hub.

* TeamCity. Надежный и качественный CI/CD-инструмент. Условно бесплатный (запуск до 3 агентов и 100 конфигураций сборок) Команды, которые работают с другими продуктами от JetBrains, часто выбирают TeamCity для большого количества функций аутентификации, развертывания и тестирования, а также поддержки Docker. Продукт обладает рядом уникальных функций, таких как подробные хронологические отчеты и мгновенные отзывы о неудачных тестах.

* GitLab Ci/CD. Один из лучших бесплатных CI/CD-инструментов. Он предлагает различные функции, такие как просмотр кода, CI/CD, непрерывное развертывание и многое другое в рамках единой системы. GitLab CI/CD позволяет выполнять параллельное тестирование различных веток кода. Для использования собственных докер-образов можно использовать docker hub, хотя GitLab имеет собственный container registry.

Для удовлетворения указанных в задании требований лучшим решением видится Gitlab CI/CD. Этот продукт содержит в себе весь необходимый функционал, легко разворачивается и удобно администрируется. Так же вокруг GitLab сложилось активное сообщество, которое способствует развитию этой платформы и её инструментов. В Gitlab нет удобного решения для хранения различных секретов, поэтому в дополнение к Gitlab можно обратить внимание на Hashicorp vault. Кроме того, GitLab имеет встроенный Wiki, встроенный механизм мониторинга и сбора метрик, управление Issues, планировщик To-Do List и др.

## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

### Решение задачи 2

На текущий момент основным решением является система сбора логов, построенная на основе стека технологий Elasticsearch-Logstash-Kibana (ELK):
- Filebeat является эффективным средством сбора данных логирования из файлов и отправки в logstash/elasticsearch.
- Logstash в Elastic-стеке сбора логов является инструментом для приёма данных, их преобразования и отправки в кластер БД elasticsearch. Может принимать логи в том числе из stdout приложений.
- Elasticsearch - база данных, адаптированная для полнотекстового поиска.
- Kibana является эффективным средством визуализации данных логов. Позволяет строить Dashbord'ы для удобства отображения и анализа логов.

## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

### Решение задачи 3

Предлагается использовать стек node_exporter + prometheus + grafana. Он соответствует всем предьявляемым требованиям.
- node_exporter - агент для сборки метрик с хост-машин и хранения их до сбора системой мониторинга prometheus;
- prometheus - ядро системы мониторинга. Получает метрики от экспортеров (node_exporter) и сохраняет их в БД временных рядов. Поддерживает мощный язык запросов PromQL (Prometheus Query Language) для выборки и агрегации метрик. Позволяет формировать правила уведомлений (alerts) на основе выражений PromQL для отправки через Alertmanager
- grafana является одной из самых популярных в мире технологией визуализации, используемой для создания панелей мониторинга. Поддерживает множество источников данных (в том числе prometheus), имеет встроенный функционал оповещений (алёртинга) на пороговые события временных рядов.
