# Домашнее задание к занятию "3.3. Операционные системы, лекция 1"

1. Какой системный вызов делает команда cd?

```bash
Команда cd делает системный вызов chdir().
С помощью команды 
strace /bin/bash -c 'cd /tmp' 2>&1 | cut -d\( -f1 | sort | uniq -c
были выведены все виды системных вызовов, которые используются командой cd. 
Их оказалось 28 видов (некоторые выполнялись многократно), 
причем один раз использовался системный вызов chdir(). 
Логично предположить, что именно он является целевым для команды cd.
```

2. Где находится база данных file на основании которой команда делает свои догадки?

```bash
В ходе анализа системных вызовов, которые выполняются командой file, 
было установлено, что таких вызовов 23 вида:
vagrant@vagrant:~$ strace file /dev/tty 2>&1 1>/dev/null | cut -d\( -f1 | sort | uniq -c | echo $(($(wc -l)-1))
23
В ходе анализа каждого из видов системных вызовов, возникло предположение, 
что обращение к базе данных предусматривает открытие файла системным вызовом openat().
Системных вызовов openat() оказалось 12 шт, при этом внимание привлекли те, 
которые ссылаются на файлы /etc/magic.mgc, /etc/magic, /usr/share/misc/magic.mgc.
Далее путем анализа указанных файлов и встроенной справки установлено, 
что искомым файлом является /usr/share/misc/magic.mgc, 
и обращение к нему выполняется системным вызовом:
openat(AT_FDCWD, "/usr/share/misc/magic.mgc", O_RDONLY) = 3
```

3. Основываясь на знаниях о перенаправлении потоков предложите способ обнуления открытого удаленного файла (чтобы освободить место на файловой системе).

```bash
Был запущен процесс, ежесекундно записывающий дату и время (через stdout) в файл date.out:
vagrant@vagrant:~$ while true; do date; sleep 1; done >> date.out &
[1] 15818
Далее был удален файл date.out,  и вывод команды 'lsof -p 15818' отобразил следующее:
bash    15818 vagrant    1w   REG  253,0     4416 1048612 /home/vagrant/date.out (deleted)
Для обнуления удаленного файла была применена команда:
vagrant@vagrant:~$ echo '' > /proc/15818/fd/1
И вывод команды 'lsof -p 15818' отобразил следующее:
bash    15818 vagrant    1w   REG  253,0      161 1048612 /home/vagrant/date.out (deleted)
То есть столбец SIZE изменил значение 4416 на 161. 
Таким образом, произошло обнуление, но пока мы выводили результат, 
данные успели разок записаться, поэтому мы увидели размер 161, а не 0. 
Соответственно, использована команда echo '' > /proc/15818/fd/1.
```

4. Занимают ли зомби-процессы какие-то ресурсы в ОС (CPU, RAM, IO)?

```bash
Зомби-процессы освобождают свои ресурсы в ОС (CPU, RAM, IO), но не освобождают запись в таблице процессов. Соответственно, ресурсы они не занимают. 
```

5. На какие файлы вы увидели вызовы группы open за первую секунду работы утилиты opensnoop?

```bash
root@vagrant:~# opensnoop-bpfcc -d 1
PID    COMM               FD ERR PATH
18377  date                3   0 /etc/ld.so.cache
18377  date                3   0 /lib/x86_64-linux-gnu/libc.so.6
18377  date                3   0 /usr/lib/locale/locale-archive
18377  date                3   0 /etc/localtime
18378  sleep               3   0 /etc/ld.so.cache
18378  sleep               3   0 /lib/x86_64-linux-gnu/libc.so.6
18378  sleep               3   0 /usr/lib/locale/locale-archive
18379  date                3   0 /etc/ld.so.cache
root@vagrant:~#
```

6. Какой системный вызов использует uname -a? Приведите цитату из man по этому системному вызову, где описывается альтернативное местоположение в /proc, где можно узнать версию ядра и релиз ОС.

```bash
системный вызов uname()
Цитата из man uname(2):
Part of the utsname information is also accessible via 
/proc/sys/kernel/{ostype, hostname, osrelease, version, domainname}.
```

7. Чем отличается последовательность команд через `;` и через `&&` в bash?

```bash
В последовательности, разделенной символом `;`, 
команды выполняются друг за другом вне зависимости от успешности выполнения каждой из них, 
то есть вне зависимости от их кодов возврата.
В случае использования `&&` последующая команда будет выполняться 
только в случае успешности выполнения предыдущей,
то есть при получении от нее кода возврата "0".
По приведенному примеру можно утверждать, что в файловой системе нет директории /tmp/some_dir,
поэтому во втором случае команда `echo Hi` и не была выполнена
```
Есть ли смысл использовать в bash &&, если применить set -e?
```bash
set -e - прерывает bash-сессию при ошибке исполнения команды (при получении кода возврата больше нуля).
Смысл есть только в том случае, если мы намеренно не хотим прерывать bash-сессию при возникновении ошибки 
выолнения команды, записанной до `&&` (проверено, сессия действительно не рвется). В иных случаях смысла нет.
```

8. Из каких опций состоит режим bash set -euxo pipefail и почему его хорошо было бы использовать в сценариях?

```bash
Описание опций:
-e - прерывает сессию при ошибке исполнения (код возврата больше нуля) любой команды кроме последней в последовательности;
-u - в сессии неустановленные (незаданные) параметры и(или) переменные оболочки считаются как ошибки.
	Сообщение об ошибке выводится в stderr и выполняется завершение работы сессии в неинтерактивной оболочке.
	В интерактивной оболочке завершение работы сессии не произойдет;
-x - вывод в stderr "трассировки" для каждой команды;
-o pipefail - демаскирование ошибок в конвейере. В случае ошибки какой-либо команды в конвейере, 
	её код возврата будет использоваться как код возврата для всего конвейера.
По сути режим 'set -euxo pipefail' для сценария повышает детализацию вывода ошибок и уровень логирования, 
и завершит выполнение сценария (на любом этапе) при возникновении различных ошибок.
Этот режим удобно использовать при разработке и отладке сценария.
```

9. Используя -o stat для ps, определите, какой наиболее часто встречающийся статус у процессов в системе.

```bash
Наиболее часто встречающийся статус у процессов в системе:
S*(S,S+,S<,Sl,SLsl,SN,S<s,Ss,Ss+,Ssl) - Процессы в статусе "Interruptible Sleeping", всего в системе оказалось 65 шт.
Описания дополнительных символов:
< - высокий приоритет (низкий nice);
N - низкий приоритет (высокий nice);
L - имеет заблокированные в памяти страницы;
s - лидер сессии;
l - многопоточный процесс;
+ - процесс в foreground-режиме (связан с терминалом).
```

