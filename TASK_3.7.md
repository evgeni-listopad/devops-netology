# Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?

```bash
Список доступных сетевых интерфейсов проверен.

В Linux можно использовать команды:
ip addr (ip a, ip -br a, ip -c -br a)
ip link (ip l, ip -br l, ip -c -br l)
ifconfig
nmcli device status (nmcli d)

В Linux можно использовать команды:
ipconfig
ipconfig /all
```

2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?

```bash
Для распознавания соседа по сетевому интерфейсу используется протокол LLDP.
Link Layer Discovery Protocol (LLDP) — протокол канального уровня, позволяющий сетевому оборудованию оповещать оборудование, 
работающее в локальной сети, о своём существовании и передавать ему свои характеристики, а также получать от него аналогичные сведения.
В Linux необходимо использоать пакет lldpd.
После его установки необходимо запустить сервис lldpd.
systemctl start lldpd.service
После этого можно воспользоваться командой lldpctl, вывод которой покажет соседа по сетевому интерфейсу,
если у соседа включена поддержка протокола lldp.
Если такая поддержка выключена, то вывод lldpctl будет пустым:
[root@server ~]# lldpctl
-------------------------------------------------------------------------------
LLDP neighbors:
-------------------------------------------------------------------------------
```

3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.

```bash
Для разделения L2 коммутатора на несколько виртуальных сетей используется технология VLAN (Virtual Local Area Network). 
В Linux используется пакет vlan.
Конфигурировать можно несколькими способами:
1) Путем создания файла физического подынтерфейса (subinterface)
2) Путем создания файла виртуального интерфейса (с именем типа "vlanXX")
3) Через NetworkManager (команды nmcli в CentOS 8)
-------------------------------------------------------------------------------
1) subinterface (пример для vlan 3)
Cоздаем файл /etc/sysconfig/network-scripts/ifcfg-ens37.3 с содержимым:
VLAN=yes
TYPE=Vlan
PHYSDEV=ens37
VLAN_ID=3
BOOTPROTO=static
IPADDR=192.168.130.130
PREFIX=24
NAME=ens37.3
DEVICE=VLAN3
ONBOOT=yes
-------------------------------------------------------------------------------
2) vlanXX (пример для vlan 5)
Cоздаем файл etc/sysconfig/network-scripts/ifcfg-vlan5 с содержимым:
VLAN=yes
TYPE=Vlan
PHYSDEV=ens37
VLAN_NAME_TYPE=VLAN_PLUS_VID_NO_PAD
VLAN_ID=5
BOOTPROTO=static
IPADDR=192.168.150.150
PREFIX=24
NAME=vlan5
DEVICE=VLAN5
ONBOOT=yes
-------------------------------------------------------------------------------
3) NetworkManager (пример для vlan 7)
nmcli connection add con-name ens37.7 type vlan ifname VLAN7 id 7 dev ens37 ipv4.addresses 192.168.170.170/24
-------------------------------------------------------------------------------
Далее перезапускаем сервис сети и проверяем примененные настройки.
[root@server network-scripts]# ip -br a
lo               UNKNOWN        127.0.0.1/8 ::1/128
ens33            UP             192.168.111.128/24 fe80::82e0:4069:4318:1075/64
ens37            UP             192.168.100.5/24 fe80::2ce4:bf9a:9ae:2408/64
VLAN3@ens37      UP             192.168.130.130/24 fe80::20c:29ff:fe6e:c10c/64
VLAN5@ens37      UP             192.168.150.150/24 fe80::20c:29ff:fe6e:c10c/64
VLAN7@ens37      UP             192.168.170.170/24 fe80::4444:1818:d59c:8be/64
```

4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.

```bash
Основными типами агрегации интерфейсов в Linux являются teaming и bonding.
-------------------------------------------------------------------------------
Опции для балансировки нагрузки:
[root@server ~]# nmcli connection add type bond mode
802.3ad        balance-alb    balance-tlb    broadcast
active-backup  balance-rr     balance-xor
-------------------------------------------------------------------------------
mode=0 (balance-rr)
Этот режим используется по-умолчанию, если в настройках не указано другое. 
balance-rr обеспечивает балансировку нагрузки и отказоустойчивость. 
В данном режиме пакеты отправляются "по кругу" от первого интерфейса к последнему и сначала. 
Если выходит из строя один из интерфейсов, пакеты отправляются на остальные оставшиеся. 
При подключении портов к разным коммутаторам, требует их настройки.

mode=1 (active-backup)
При active-backup один интерфейс работает в активном режиме, остальные в ожидающем. 
Если активный падает, управление передается одному из ожидающих. 
Не требует поддержки данной функциональности от коммутатора.

mode=2 (balance-xor)
Передача пакетов распределяется между объединенными интерфейсами по формуле 
((MAC-адрес источника) XOR (MAC-адрес получателя)) % число интерфейсов. 
Один и тот же интерфейс работает с определённым получателем. 
Режим даёт балансировку нагрузки и отказоустойчивость.

mode=3 (broadcast)
Происходит передача во все объединенные интерфейсы, обеспечивая отказоустойчивость.

mode=4 (802.3ad)
Это динамическое объединение портов. 
В данном режиме можно получить значительное увеличение пропускной способности как входящего 
так и исходящего трафика, используя все объединенные интерфейсы. 
Требует поддержки режима от коммутатора, а так же (иногда) дополнительную настройку коммутатора.

mode=5 (balance-tlb)
Адаптивная балансировка нагрузки. 
При balance-tlb входящий трафик получается только активным интерфейсом, 
исходящий - распределяется в зависимости от текущей загрузки каждого интерфейса. 
Обеспечивается отказоустойчивость и распределение нагрузки исходящего трафика. 
Не требует специальной поддержки коммутатора.

mode=6 (balance-alb)
Адаптивная балансировка нагрузки (более совершенная). 
Обеспечивает балансировку нагрузки как исходящего (TLB, transmit load balancing), 
так и входящего трафика (для IPv4 через ARP). 
Не требует специальной поддержки коммутатором, но требует возможности изменять MAC-адрес устройства.
-------------------------------------------------------------------------------
Пример конфига (через NetworkManager):
[root@server ~]# ip -br l
lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP>
ens33            UP             00:0c:29:6e:c1:02 <BROADCAST,MULTICAST,UP,LOWER_UP>
ens37            UP             00:0c:29:6e:c1:0c <BROADCAST,MULTICAST,UP,LOWER_UP>
ens38            UP             00:0c:29:6e:c1:16 <BROADCAST,MULTICAST,UP,LOWER_UP>
ens39            UP             00:0c:29:6e:c1:20 <BROADCAST,MULTICAST,UP,LOWER_UP>
[root@server ~]# nmcli con add type bond con-name bond0 ifname bond0 mode balance-rr ipv4.addresses 192.168.200.200/24           
Connection 'bond0' (d3f3debf-1234-4a46-9f2c-d2f2543cf99b) successfully added.
[root@server ~]# nmcli con add type bond-slave ifname ens38 master bond0
Connection 'bond-slave-ens38' (4fadf2f9-4a22-45e1-be3f-615e4d90212a) successfully added.
[root@server ~]# nmcli con add type bond-slave ifname ens39 master bond0
Connection 'bond-slave-ens39' (f9669d44-a927-49b0-b54c-5cfd6a2814e5) successfully added.
[root@server ~]# ip -br a
lo               UNKNOWN        127.0.0.1/8 ::1/128
ens33            UP             192.168.111.128/24 fe80::82e0:4069:4318:1075/64
ens37            UP             192.168.100.5/24 fe80::2ce4:bf9a:9ae:2408/64
ens38            UP
ens39            UP
bond0            UP             192.168.200.200/24 192.168.147.128/24 fe80::4695:df85:aa9f:b312/64
[root@server ~]#
-------------------------------------------------------------------------------
Пример конфига из файла ifcfg-bond0:
[root@server ~]# cat /etc/sysconfig/network-scripts/ifcfg-bond0
BONDING_OPTS=mode=balance-rr
TYPE=Bond
BONDING_MASTER=yes
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=dhcp
IPADDR=192.168.200.200
PREFIX=24
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
NAME=bond0
UUID=d3f3debf-1234-4a46-9f2c-d2f2543cf99b
DEVICE=bond0
ONBOOT=yes
-------------------------------------------------------------------------------
Пример конфига из файла ifcfg-bond-slave-ens38:
[root@server ~]# cat /etc/sysconfig/network-scripts/ifcfg-bond-slave-ens38
TYPE=Ethernet
NAME=bond-slave-ens38
UUID=4fadf2f9-4a22-45e1-be3f-615e4d90212a
DEVICE=ens38
ONBOOT=yes
MASTER=bond0
SLAVE=yes
-------------------------------------------------------------------------------
Пример конфига из файла ifcfg-bond-slave-ens39:
[root@server ~]# cat /etc/sysconfig/network-scripts/ifcfg-bond-slave-ens39
TYPE=Ethernet
NAME=bond-slave-ens39
UUID=f9669d44-a927-49b0-b54c-5cfd6a2814e5
DEVICE=ens39
ONBOOT=yes
MASTER=bond0
SLAVE=yes
```

5. Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

```bash
[root@server ~]# ipcalc 10.10.10.0/29
Network:        10.10.10.0/29
Netmask:        255.255.255.248 = 29
Broadcast:      10.10.10.7

Address space:  Private Use
Address class:  Class A
HostMin:        10.10.10.1
HostMax:        10.10.10.6
Hosts/Net:      6
-------------------------------------------------------------------------------
В сети с маской /29 доступно 6 IP-адресов для хостов (+1 адрес самой сети, +1 broadcast-адрес).
Из сети с маской /24 можно получить 32 подсети с маской /29 (256/8=32)
-------------------------------------------------------------------------------
Примеры подсетей с маской /29 внутри сети 10.10.10.0/24:
10.10.10.0/29
10.10.10.8/29
10.10.10.16/29
10.10.10.24/29
10.10.10.32/29
10.10.10.40/29
...
10.10.10.240/29
10.10.10.248/29
```

6. Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.

```bash
Для использования в сетях сервис-провайдеров предназначена сеть 100.64.0.0/10. 
Глобальная маршрутизация IP-адресов из указанной сети запрещена, поэтому она нам подходит.
Маску выберем 255.255.255.192 (/26) на 62 хоста.
-------------------------------------------------------------------------------
[root@server ~]# ipcalc 100.64.0.0/26
Network:        100.64.0.0/26
Netmask:        255.255.255.192 = 26
Broadcast:      100.64.0.63

Address space:  Shared Address Space
Address class:  Class A
HostMin:        100.64.0.1
HostMax:        100.64.0.62
Hosts/Net:      62
```

7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?

```bash
Команды проверки ARP таблицы в Linux:
arp -n
ip neigh
Команды проверки ARP таблицы в Windows:
arp -a
arp -g
-------------------------------------------------------------------------------
Команда полной очистки ARP таблицы в Linux:
ip neigh flush all
Команды полной очистки ARP таблицы в Windows:
arp -d *
netsh interface ipv4 delete arpcache
-------------------------------------------------------------------------------
Удаление одного IP из ARP таблицы в Linux:
arp -d 192.168.200.200
ip neigh flush 192.168.200.200
Удаление одного IP из ARP таблицы в Windows:
arp -d 192.168.200.200 
```

